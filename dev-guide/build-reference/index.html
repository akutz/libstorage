<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://github.com/codedellemc/libstorage/dev-guide/build-reference/">
        <link rel="shortcut icon" href="favicon.ico">
        

	<title>Build Reference - libStorage</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/base.css" rel="stylesheet">
        <link href="../../css/emccode.css" rel="stylesheet">
        <link href="../../css/emccode-font.css" rel="stylesheet">
        <link href="../../css/hX.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        

        <!-- scroll fix -->
        <script>
            //var shiftWindow = function() { scrollBy(0, -40) };
            //if (location.hash) shiftWindow();
            //window.addEventListener("hashchange", shiftWindow);
        </script>

    </head>

    <body >

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../..">
                <i class="fa icon-libstorage-logo"></i>
                libStorage
            </a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../..">Home</a>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">User Guide <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../user-guide/config/">Configuration</a>
                        </li>
                    
                        <li >
                            <a href="../../user-guide/storage-providers/">Storage Providers</a>
                        </li>
                    
                        <li >
                            <a href="../../user-guide/schedulers/">Schedulers</a>
                        </li>
                    
                    </ul>
                </li>
                <!--
                smart menus
                <li><a href="#">User Guide <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                    
                    
                        <li >
                            <a href="../../user-guide/config/">Configuration</a>
                        </li>
                    
                    
                    
                        <li >
                            <a href="../../user-guide/storage-providers/">Storage Providers</a>
                        </li>
                    
                    
                    
                        <li >
                            <a href="../../user-guide/schedulers/">Schedulers</a>
                        </li>
                    
                    
                    </ul>
                </li>
                -->
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Developers Guide <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../project-guidelines/">Project Guidelines</a>
                        </li>
                    
                        <li class="active">
                            <a href="./">Build Reference</a>
                        </li>
                    
                        <li >
                            <a href="../release-process/">Release Process</a>
                        </li>
                    
                    </ul>
                </li>
                <!--
                smart menus
                <li><a href="#">Developers Guide <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                    
                    
                        <li >
                            <a href="../project-guidelines/">Project Guidelines</a>
                        </li>
                    
                    
                    
                        <li class="active">
                            <a href="./">Build Reference</a>
                        </li>
                    
                    
                    
                        <li >
                            <a href="../release-process/">Release Process</a>
                        </li>
                    
                    
                    </ul>
                </li>
                -->
            
            
            
                <li >
                    <a href="../../api/">API</a>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../about/contributing/">Contributing</a>
                        </li>
                    
                        <li >
                            <a href="../../about/license/">License</a>
                        </li>
                    
                        <li >
                            <a href="../../about/release-notes/">Release Notes</a>
                        </li>
                    
                    </ul>
                </li>
                <!--
                smart menus
                <li><a href="#">About <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                    
                    
                        <li >
                            <a href="../../about/contributing/">Contributing</a>
                        </li>
                    
                    
                    
                        <li >
                            <a href="../../about/license/">License</a>
                        </li>
                    
                    
                    
                        <li >
                            <a href="../../about/release-notes/">Release Notes</a>
                        </li>
                    
                    
                    </ul>
                </li>
                -->
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li >
                    <a rel="next" href="../project-guidelines/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../release-process/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                <li>
                    <a href="https://github.com/codedellemc/libstorage.git">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
                <li>
                    <a href="https://emccode.github.io">
                        <i class="fa icon-emccode-logo"></i>
                    </a>
                </li>
            </ul>
        </div>
    </div>
</div>
        
        <div class="container ">
            <div class="col-md-3"><div id="sidenav" class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#build-reference">Build Reference</a></li>
        
            <li><a href="#basic-builds">Basic Builds</a>
            
                <ul class="nav nav-stacked">
                
                <li><a href="#basic-build-requirements">Basic Build Requirements</a><!--
                -->
                </li>
                
                <li><a href="#basic-build-targets">Basic Build Targets</a><!--
                -->
                </li>
                
                <li><a href="#basic-build-options">Basic Build Options</a><!--
                -->
                </li>
                
                </ul>
            
            </li>
        
            <li><a href="#advanced-builds">Advanced Builds</a>
            
                <ul class="nav nav-stacked">
                
                <li><a href="#advanced-build-requirements">Advanced Build Requirements</a><!--
                -->
                </li>
                
                <li><a href="#advanced-build-targets">Advanced Build Targets</a><!--
                -->
                </li>
                
                <li><a href="#advanced-build-options">Advanced Build Options</a><!--
                -->
                </li>
                
                </ul>
            
            </li>
        
            <li><a href="#version-file">Version File</a>
            
            </li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="build-reference">Build Reference<a class="headerlink" href="#build-reference" title="Permanent link">&para;</a></h1>
<p>How to build libStorage</p>
<hr />
<h2 id="basic-builds">Basic Builds<a class="headerlink" href="#basic-builds" title="Permanent link">&para;</a></h2>
<p>The following one-line command is the quickest, simplest, and most
deterministic approach to building libStorage:</p>
<pre><code class="bash">$ git clone https://github.com/codedellemc/libstorage &amp;&amp; make -C libstorage
</code></pre>

<div class="admonition note">
<p class="admonition-title">note</p>
<p>The above <code>make</code> command defaults to the <code>docker-build</code> target only if
Docker is detected and running on a host, otherwise the <code>build</code> target is
used. For more information about the <code>build</code> target, please see the
<a href="#advanced-builds">Advanced Builds</a> section.</p>
</div>
<h3 id="basic-build-requirements">Basic Build Requirements<a class="headerlink" href="#basic-build-requirements" title="Permanent link">&para;</a></h3>
<p>Building libStorage with Docker has the following requirements:</p>
<table>
<thead>
<tr>
<th>Requirement</th>
<th>Version</th>
</tr>
</thead>
<tbody>
<tr>
<td>Operating System</td>
<td>Linux, OS X</td>
</tr>
<tr>
<td><a href="https://www.docker.com/">Docker</a></td>
<td>&gt;=1.11</td>
</tr>
<tr>
<td><a href="https://www.gnu.org/software/make/">GNU Make</a></td>
<td>&gt;=3.80</td>
</tr>
<tr>
<td><a href="https://git-scm.com/">Git</a></td>
<td>&gt;= 1.7</td>
</tr>
</tbody>
</table>
<p>OS X ships with a very old version of GNU Make, and a package manager like
<a href="http://brew.sh/">Homebrew</a> can be used to install the required version.</p>
<h3 id="basic-build-targets">Basic Build Targets<a class="headerlink" href="#basic-build-targets" title="Permanent link">&para;</a></h3>
<p>The following targets are available when building libStorage with Docker:</p>
<table>
<thead>
<tr>
<th>Target</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>docker-build</code></td>
<td>Builds libStorage inside a Docker container.</td>
</tr>
<tr>
<td><code>docker-test</code></td>
<td>Executes all of the libStorage tests inside the container.</td>
</tr>
<tr>
<td><code>docker-clean</code></td>
<td>This target stops and removes the default container used for libStorage builds. The name of the default container is <code>build-libstorage</code>.</td>
</tr>
<tr>
<td><code>docker-clobber</code></td>
<td>This target stops and removes all Docker containers that have a name that matches the name of the configured container prefix (default prefix is <code>build-libstorage</code>).</td>
</tr>
<tr>
<td><code>docker-list</code></td>
<td>Lists all Docker containers that have a name that matches the name of the configured prefix (default prefix is <code>build-libstorage</code>).</td>
</tr>
</tbody>
</table>
<h3 id="basic-build-options">Basic Build Options<a class="headerlink" href="#basic-build-options" title="Permanent link">&para;</a></h3>
<p>The following options (via environment variables) can be used to influence
how libStorage is built with Docker:</p>
<table>
<thead>
<tr>
<th>Environment Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>DRIVERS</code></td>
<td>This variable can be set to a space-delimited list of driver names in order to indicate which storage platforms to support. For example, the command <code>$ DRIVERS="ebs scaleio" make docker-build</code> would build libStorage for only the EBS and ScaleIO storage platforms.</td>
</tr>
<tr>
<td><code>DBUILD_ONCE</code></td>
<td>When set to <code>1</code>, this environment variable instructs the Makefile to create a temporary, one-time use container for the subsequent build. The container is removed upon a successful build. If the build fails the container is not removed. This is because Makefile error logic is lacking. However, <code>make docker-clobber</code> can be used to easily clean up these containers. The containers will follow a given pattern using the container prefix (<code>build-libstorage</code> is the default prefix value). The one-time containers use <code>PREFIX-EPOCH</code>. For example, <code>build-libstorage-1474691232</code>.</td>
</tr>
<tr>
<td><code>DGOOS</code></td>
<td>This sets the OS target for which to build the libStorage binaries. Valid values are <code>linux</code> and <code>darwin</code>. If omitted the host OS value returned from <code>uname -s</code> is used instead.</td>
</tr>
<tr>
<td><code>DLOCAL_IMPORTS</code></td>
<td>Specify a list of space-delimited import paths that will be copied from the host OS's <code>GOPATH</code> into the container build's vendor area, overriding the dependency code that would normally be fetched by Glide.<br/><br/>For example, the project's <code>glide.yaml</code> file might specify to build REX-Ray with libStorage v0.2.1. However, the following command will build REX-Ray using the libStorage sources on the host OS at <code>$GOPATH/src/github.com/codedellemc/libstorage</code>:<br/><br/><pre lang="bash">$ DLOCAL_IMPORTS=github.com/codedellemc/libstorage make docker-build</pre>Using local sources can sometimes present a problem due to missing dependencies. Please see the next environment variable for instructions on how to overcome this issue.</td>
</tr>
<tr>
<td><code>DGLIDE_YAML</code></td>
<td>Specify a file that will be used for the container build in place of the standard <code>glide.yaml</code> file.<br/><br/>This is necessary for occasions when sources injected into the build via the <code>DLOCAL_IMPORTS</code> variable import packages that are not imported by the package specified in the project's standard <code>glide.yaml</code> file.<br/><br/>For example, if <code>glide.yaml</code> specifies that libStorage depends upon AWS SDK v1.2.2, but <code>DLOCAL_IMPORTS</code> specifies the value <code>github.com/aws/aws-sdk-go</code> and the AWS SDK source code on the host includes a new dependency not present in the v1.2.2 version, Glide will not fetch the new dependency when doing the container build.<br/><br/>So it may be necessary to use <code>DGLIDE_YAML</code> to provide a superset of the project's standard <code>glide.yaml</code> file which also includes the dependencies necessary to build the packages specified in <code>DLOCAL_IMPORTS</code>.</td>
</tr>
</tbody>
</table>
<h2 id="advanced-builds">Advanced Builds<a class="headerlink" href="#advanced-builds" title="Permanent link">&para;</a></h2>
<p>While building libStorage with Docker is simple, it ultimately relies on the
same <code>Makefile</code> included in the libStorage repository and so it's entirely
possible (and often desirable) to build libStorage directly.</p>
<h3 id="advanced-build-requirements">Advanced Build Requirements<a class="headerlink" href="#advanced-build-requirements" title="Permanent link">&para;</a></h3>
<p>This project has very few build requirements, but there are still one or two
items of which to be aware. Also, please note that this are the requirements to
<em>build</em> <code>libStorage</code>, not run it.</p>
<table>
<thead>
<tr>
<th>Requirement</th>
<th>Version</th>
</tr>
</thead>
<tbody>
<tr>
<td>Operating System</td>
<td>Linux, OS X</td>
</tr>
<tr>
<td><a href="https://golang.org/">Go</a></td>
<td>&gt;=1.6</td>
</tr>
<tr>
<td><a href="https://www.gnu.org/software/make/">GNU Make</a></td>
<td>&gt;=3.80</td>
</tr>
<tr>
<td><a href="https://glide.sh/">Glide</a></td>
<td>&gt;=0.10</td>
</tr>
<tr>
<td><a href="https://developer.apple.com/library/ios/technotes/tn2339/_index.html">X-Code Command Line Tools (OS X only)</a></td>
<td>&gt;= OS X 10.9</td>
</tr>
<tr>
<td>Linux Kernel Headers (Linux only)</td>
<td>&gt;=Linux Kernel 3.13</td>
</tr>
<tr>
<td><a href="https://gcc.gnu.org/">GNU C Compiler</a> (Linux only)</td>
<td>&gt;= 4.8</td>
</tr>
<tr>
<td><a href="https://www.perl.org/">Perl</a></td>
<td>&gt;= 5.0</td>
</tr>
<tr>
<td><a href="https://git-scm.com/">Git</a></td>
<td>&gt;= 1.7</td>
</tr>
</tbody>
</table>
<p>OS X ships with a very old version of GNU Make, and a package manager like
<a href="http://brew.sh/">Homebrew</a> can be used to install the required version.</p>
<p>It's also possible to use GCC as the Cgo compiler for OS X or to use Clang on
Linux, but by default Clang is used on OS X and GCC on Linux.</p>
<h3 id="advanced-build-targets">Advanced Build Targets<a class="headerlink" href="#advanced-build-targets" title="Permanent link">&para;</a></h3>
<p>The following targets are available when building libStorage directly:</p>
<table>
<thead>
<tr>
<th>Target</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>build</code></td>
<td>Builds libStorage.</td>
</tr>
<tr>
<td><code>test</code></td>
<td>Executes all of the libStorage tests.</td>
</tr>
<tr>
<td><code>clean</code></td>
<td>This target removes all of the source file markers.</td>
</tr>
<tr>
<td><code>clobber</code></td>
<td>This is the same as <code>clean</code> but also removes any produced artifacts.</td>
</tr>
</tbody>
</table>
<h3 id="advanced-build-options">Advanced Build Options<a class="headerlink" href="#advanced-build-options" title="Permanent link">&para;</a></h3>
<p>The following options (via environment variables) can be used to influence
how libStorage is built:</p>
<table>
<thead>
<tr>
<th>Environment Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>DRIVERS</code></td>
<td>This variable can be set to a space-delimited list of driver names in order to indicate which storage platforms to support. For example, the command <code>$ DRIVERS="ebs scaleio" make build</code> would build libStorage for only the EBS and ScaleIO storage platforms.</td>
</tr>
</tbody>
</table>
<h2 id="version-file">Version File<a class="headerlink" href="#version-file" title="Permanent link">&para;</a></h2>
<p>There is a file at the root of the project named <code>VERSION</code>. The file contains
a single line with the <em>target</em> version of the project in the file. The version
follows the format:</p>
<p><code>(?&lt;major&gt;\d+)\.(?&lt;minor&gt;\d+)\.(?&lt;patch&gt;\d+)(-rc\d+)?</code></p>
<p>For example, during active development of version <code>0.1.0</code> the file would
contain the version <code>0.1.0</code>. When it's time to create <code>0.1.0</code>'s first
release candidate the version in the file will be changed to <code>0.1.0-rc1</code>. And
when it's time to release <code>0.1.0</code> the version is changed back to <code>0.1.0</code>.</p>
<p>So what's the point of the file if it's basically duplicating the utility of a
tag? Well, the <code>VERSION</code> file in fact has two purposes:</p>
<ol>
<li>
<p>First and foremost updating the <code>VERSION</code> file with the same value as that
     of the tag used to create a release provides a single, contextual reason to
     push a commit and tag. Otherwise some random commit off of <code>master</code> would
     be tagged as a release candidate or release. Always using the commit that
     is related to updating the <code>VERSION</code> file is much cleaner.</p>
</li>
<li>
<p>The contents of the <code>VERSION</code> file are also used during the build process
     as a means of overriding the output of a <code>git describe</code>. This enables the
     semantic version injected into the produced binary to be created using
     the <em>targeted</em> version of the next release and not just the value of the
     last, tagged commit.</p>
</li>
</ol></div>
        </div>
        

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script src="../../js/base.js"></script>
        <!--
        <script src="../../.themes/yeti/js/base.js"></script>
        <script src="../../.themes/yeti/js/bootstrap-3.0.3.min.js"></script>
        <script src="../../.themes/yeti/js/highlight.pack.js"></script>
        <script src="../../.themes/yeti/js/jquery-1.10.2.min.js"></script>
        -->

    </body>

</html>